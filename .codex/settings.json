{
  "$version": 2,
  "mcpServers": {
    "tinymem": {
      "args": [
        "mcp"
      ],
      "command": "tinymem",
      "env": {
        "TINYMEM_LOGGING": "debug",
        "TINYMEM_METRICS_ENABLED": "true"
      },
      "timeout": 30000,
      "trust": false
    }
  },
  "tinymem_protocol": "# TINYMEM CONTROL PROTOCOL\n\n## Hard Enforcement Specification for Repository-Aware AI Agents\n\nThis protocol governs **all repository-related behavior**.\n\nIt is **authoritative**, **mandatory**, and **self-validating**.\nNon-compliance invalidates the response by definition.\n\n---\n\n## 0. Binding Definitions\n\n**Repository-related request**\nAny request that touches code, files, documentation, architecture, configuration, tasks, planning, or repository state.\n\n**TinyMem command**\nA real, externally executed memory tool invocation (`memory_query`, `memory_recent`, etc.).\nInternal recall, inference, or chat reconstruction does **not** qualify.\n\n**Valid response**\nA response that demonstrates protocol compliance through observable actions and explicit declarations.\n\n---\n\n## 1. Absolute Precondition (Hard Gate)\n\n**Before producing ANY repository-related response, the agent MUST execute at least one TinyMem command.**\n\nThis is a hard gate.\n\nIf no TinyMem command is executed:\n\n* The response is invalid\n* The agent must not proceed\n* Partial or “best-effort” responses are forbidden\n\nThere are no exceptions.\n\n---\n\n## 2. Proof-of-Execution Requirement (Anti-Circumvention)\n\nEvery valid repository-related response MUST include **explicit proof** of TinyMem execution.\n\nAcceptable proof consists of one of the following:\n\n* A visible TinyMem tool invocation in the response\n* A verifiable execution record emitted by the environment\n\nSilent execution is forbidden.\nMissing proof invalidates the response.\n\n---\n\n## 3. Mandatory Execution Order (Non-Reorderable)\n\nThe following steps MUST be executed **in strict order**.\nSkipping, merging, or reordering steps is a violation.\n\n---\n\n### Step 1: Memory Recall (MANDATORY, FIRST)\n\nThe agent MUST execute **at least one** of the following **before any reasoning**:\n\n```\nmemory_query(\"\")\nmemory_recent()\nmemory_query(\"\u003cspecific topic\u003e\")\n```\n\nRules:\n\n* This must be a real tool execution\n* Assumed recall is forbidden\n* Chat history does not count\n* “No relevant memory” is illegal unless a query was executed\n\nNo recall → stop immediately.\n\n---\n\n### Step 2: Memory Acknowledgement (MANDATORY)\n\nImmediately after recall, the agent MUST explicitly state **one and only one** of the following:\n\n* **“Relevant memory found and applied.”**\n* **“Memory queried. No relevant memory found.”**\n\nOmission or paraphrasing invalidates the response.\n\n---\n\n### Step 3: Task Authority Lock (MANDATORY WHEN APPLICABLE)\n\nIf `tinyTasks.md` exists, it is **exclusive and authoritative**.\n\nRules:\n\n* The file MUST be read before any action\n* Memory MUST NOT override task state\n* Task state MUST NOT be inferred\n\nFor any non-trivial, multi-step, or stateful request, the agent MUST:\n\n1. Create or update `tinyTasks.md`\n2. Resume from the **first unchecked subtask**\n3. Update tasks **as execution progresses**\n4. Mark tasks complete **only when actually finished**\n\nRequired structure (no deviations allowed):\n\n```md\n# Tasks – \u003cGoal\u003e\n\n- [ ] Top-level task\n  - [ ] Atomic subtask\n  - [ ] Atomic subtask\n```\n\nFailure to update tasks is a protocol failure.\n\n---\n\n### Step 3.5: Autonomous Repair (The Ralph Loop)\n\nFor complex, iterative tasks requiring verification (e.g., fixing failing tests), the agent SHOULD invoke `memory_ralph`.\n\n**Control Transfer Contract:**\n1. Once `memory_ralph` is invoked, control transfers to tinyMem.\n2. The agent may not execute individual shell commands or declare success until the loop returns.\n3. Termination is controlled solely by **Evidence Evaluation**.\n\n**Execution Phases:**\n- **Execute**: tinyMem runs the verification command (e.g., `go test`).\n- **Recall**: On failure, tinyMem retrieves relevant memories and failure patterns.\n- **Repair**: tinyMem uses its internal LLM to apply code fixes based on context.\n- **Evidence**: Success is declared only if all evidence predicates pass.\n  - **Format Requirement**: Predicates MUST use the `type::content` format (e.g., `test_pass::go test ./...`, `file_exists::path/to/file`).\n\n**Safety Rules:**\n- Agents MUST provide `forbid_paths` for sensitive directories.\n- Agents SHOULD set `max_iterations` to prevent runaway token usage.\n\n---\n\n### Step 4: Execution Phase\n\nOnly after Steps 1–3 are complete may the agent:\n\n* Perform the requested work\n* Modify code, documentation, or plans\n* Propose or apply decisions\n\nAny execution before this point invalidates the response.\n\n---\n\n### Step 5: Durable Memory Writeback (MANDATORY WHEN APPLICABLE)\n\nIf the response introduces, confirms, or corrects **durable knowledge**, the agent MUST write it to TinyMem **before concluding**.\n\nDurable knowledge includes:\n\n* Decisions\n* Constraints or invariants\n* Architectural rules\n* Corrections to assumptions\n* Explicit user confirmations\n* Non-obvious conclusions\n\nIf and only if no durable knowledge was produced, the agent MUST state verbatim:\n\n\u003e No durable memory write required for this response.\n\nMissing or altered wording invalidates the response.\n\n---\n\n### Step 6: End-of-Response Self-Validation (MANDATORY)\n\nThe response MUST end with an explicit checklist confirming all of the following:\n\n* TinyMem command executed\n* Memory integrated or explicitly confirmed empty\n* `tinyTasks.md` read and updated if applicable\n* No completed tasks left unchecked\n* No unchecked tasks remain unless explicitly blocked\n\nIf any item cannot be affirmed, the agent MUST continue execution.\nThe response may not terminate.\n\n---\n\n## 4. Error Handling (Fail Closed)\n\nIf any TinyMem operation fails:\n\n* The failure MUST be explicitly declared\n* Memory guarantees are considered degraded\n* Planning, restructuring, or irreversible changes are forbidden\n* Only safe, local, reversible actions are allowed\n\nSilent failure is a critical violation.\n\n---\n\n## 5. Invalid Actions (Automatic Failure)\n\nAny of the following immediately invalidate the response:\n\n* No TinyMem command executed\n* No proof of execution shown\n* Claiming memory state without querying\n* Inferring task state\n* Ignoring `tinyTasks.md`\n* Declaring completion with unchecked tasks\n* Writing speculative, temporary, or reversible information to memory\n* Ending the response without explicit self-validation\n\n---\n\n## 6. Enforcement Invariant (Unbreakable)\n\n\u003e A repository-related response without a TinyMem tool invocation is not a response. It is a failure.\n\nMemory is mandatory.\nInference is failure.\nExecution state lives in files.\n\n---\n\n**End of Protocol**"
}